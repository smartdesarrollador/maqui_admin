<div class="p-6">
  <!-- Header -->
  <div class="mb-6 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Gestión de Motos</h1>
      <p class="mt-1 text-sm text-gray-600">
        Administra el catálogo de motos disponibles
      </p>
    </div>
    <button
      routerLink="create"
      class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 inline-flex items-center gap-2"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-5 h-5"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12 4.5v15m7.5-7.5h-15"
        />
      </svg>
      Crear Moto
    </button>
  </div>

  <!-- Filtros -->
  <div class="bg-white p-4 rounded-lg shadow mb-6">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <!-- Buscador -->
      <div class="col-span-1 md:col-span-2">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (keyup.enter)="onSearch()"
          placeholder="Buscar por modelo, marca o descripción..."
          class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        />
      </div>

      <!-- Filtro de precio -->
      <div class="flex gap-2">
        <input
          type="number"
          [(ngModel)]="precioMin"
          placeholder="Precio mín"
          class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        />
        <input
          type="number"
          [(ngModel)]="precioMax"
          placeholder="Precio máx"
          class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        />
      </div>

      <!-- Botones de acción -->
      <div class="flex gap-2">
        <button
          (click)="onSearch()"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500"
        >
          Buscar
        </button>
        <button
          (click)="clearFilters()"
          class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 focus:ring-2 focus:ring-gray-500"
        >
          Limpiar
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla de motos -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div class="min-w-full divide-y divide-gray-200">
      <!-- Loading state -->
      @if (isLoading) {
      <div class="flex justify-center items-center p-8">
        <div
          class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
        ></div>
      </div>
      }

      <!-- Tabla -->
      @if (!isLoading && motos.length > 0) {
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th
              *ngFor="
                let header of [
                  'Imagen',
                  'Modelo',
                  'Marca',
                  'Precio',
                  'Stock',
                  'Acciones'
                ]
              "
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              {{ header }}
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for (moto of motos; track moto.id_moto) {
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap">
              <img
                [ngSrc]="'http://127.0.0.1:8000/' + moto.imagen"
                [alt]="moto.modelo.nombre"
                width="100"
                height="100"
                class="h-16 w-16 object-cover rounded-lg"
              />
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm font-medium text-gray-900">
                {{ moto.modelo.nombre }}
              </div>
              <div class="text-sm text-gray-500">{{ moto.cilindrada }} cc</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">
                {{ moto.modelo.marca.nombre }}
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">${{ moto.precio_base }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                [class]="
                  moto.stock > 0
                    ? 'bg-green-100 text-green-800'
                    : 'bg-red-100 text-red-800'
                "
                class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
              >
                {{ moto.stock }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <div class="flex gap-2">
                <button
                  class="text-blue-600 hover:text-blue-900"
                  [routerLink]="['/admin/motos/edit', moto.id_moto]"
                >
                  Editar
                </button>
                <button
                  class="text-red-600 hover:text-red-900"
                  (click)="deleteMoto(moto.id_moto)"
                >
                  Eliminar
                </button>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>

      <!-- Paginación -->
      <div
        class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"
      >
        <div class="flex-1 flex justify-between sm:hidden">
          <button
            [disabled]="currentPage === 1"
            (click)="onPageChange(currentPage - 1)"
            class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
          >
            Anterior
          </button>
          <button
            [disabled]="currentPage * itemsPerPage >= totalItems"
            (click)="onPageChange(currentPage + 1)"
            class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
          >
            Siguiente
          </button>
        </div>
        <div
          class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"
        >
          <div>
            <p class="text-sm text-gray-700">
              Mostrando
              <span class="font-medium">{{
                (currentPage - 1) * itemsPerPage + 1
              }}</span>
              a
              <span class="font-medium">
                {{ Math.min(currentPage * itemsPerPage, totalItems) }}
              </span>
              de
              <span class="font-medium">{{ totalItems }}</span>
              resultados
            </p>
          </div>
          <div>
            <nav
              class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px"
            >
              @for (page of Array(Math.ceil(totalItems / itemsPerPage)); track
              $index) {
              <button
                (click)="onPageChange($index + 1)"
                [class.bg-blue-50]="currentPage === $index + 1"
                [class.text-blue-600]="currentPage === $index + 1"
                class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"
              >
                {{ $index + 1 }}
              </button>
              }
            </nav>
          </div>
        </div>
      </div>
      }

      <!-- Estado vacío -->
      @if (!isLoading && motos.length === 0) {
      <div class="text-center py-12">
        <svg
          class="mx-auto h-12 w-12 text-gray-400"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
          />
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No hay motos</h3>
        <p class="mt-1 text-sm text-gray-500">
          No se encontraron motos que coincidan con los criterios de búsqueda.
        </p>
      </div>
      }
    </div>
  </div>
</div>
